# 分享底稿



page1：欢迎大家参与到这次的分享，我是。。。来自海付收单团队, u can call me Roylic。这次分享主要是以一个数字货币爱好者的角度，通过一个账本来贯穿不同支付形式，并通过对比，展示其异同点。

page2：分享的内容主要分5个部分，从非电子支付的原始交易开始引出账本的概念，再到我们现在主流的传统支付，区块链支付，以及CBDC，央行数字货币支付。比重大致是1：1：6：2.5。

(**fast**)page3+4：前面内容较为简单，我会讲快一些。首先穿越回还没有电子支付，并且只接受实时交易的时代。假设ABCD经常需要进行P2P交易的时候。由于没有便捷的支付，很容易就会出现：1）某一时刻我资金周转问题，B必须要接收到A转过来的钱才足以支付C，或者2）由于我们只是货币交易，我们交易双方不是同一地点，可能就无法完成交易。这两个问题核心在于时间维度的缺失。

(**fast**)page5：为交易添加时间维度，就引出了账本。其实就是一个记录，把一段的交易记录下来，然后我们就可以把资金的结算滞后，也就是所谓的异步。这样我们就可以避免上面的两个问题。

(**fast**)page6：于此同时另一个问题出现了。但因为账本是不属于任何一个人，大家都有修改的权力，会出现什么问题呢？例如：1）A偷偷在账本记上了向C付款了200刀。但实际C并没有收到。或者2）D直接添加结算说资金应该结算1千万。那么究竟谁来掌管这个账本，才能确保公正呢？

(**fast**)page7+8：历史进程为我们阐述了前几辈人做出的选择，那就是选择一个可靠且交易双方都信任的第三方来作为交易的担保方。通常都是银行或者卡组织来从当这样的角色，相较于直接交易，银行为我们提供了账户的概念。而账本也就理所当然的让银行进行保管和操作。这里的第三方在此也从当了仲裁的角色，例如在买方发起拒付，卖方并不能决定退款与否。而是由第三方，来收集信息，在做仲裁。

(**fast**)page9：如果我们把这个交易的链路放大，跨国的交易，也引出了跨境交易的巨头SWIFT。显而易见，由于这种使用第三方担保方式处理账本问题，难以避免的是这个中间节点所拥有的权力。像是伊朗就被逐出了不能使用SWIFT进行结算，交易除了交易双方意愿，还可能因为政治因素或者别的原因所影响。于此同时，每个短链路上的手续费也是不可避免的，如果还要算上清算和结算，更多的中间人将会从中抽取费用。

page10：那么有没有可能，通过某种方式剔除这个中间人，并且能够公平可靠其有保障的进行交易呢？也就是用技术方式来解决遇到的问题。

page11：这里就引入了本次分享的重点，去中心化交易，也就是区块链交易。我们一步步看看技术是怎么让这个方法可行且可靠的。

page12：让我们回到刚刚选择可信任第三方处理账本的这个时刻，让我们先放下账本掌控权引发的问题。没有了第三方还可能出现什么问题：比如我们是按月结算，在月底A发现资金透支了，怎么办，他选择跑路。那么就只剩下BCD三个原地哭泣。但是其实这个问题可以很简单被解决，不允许透支。这里账本在不引入第三方的情况下，引入了账户的概念。每个账户都有余额，不允许透支，就可以解决这个问题。于此同时，由于账户是依附于账本的，同一体系下，余额仅仅是数字概念，这个数字与某个特定币种（法币），就可以脱离强关联了。

page13：相对于原来的体系，现在我们可以用“代币”，来指代账本中的花费，比如我就叫BTC。账户的充值和提现，再与不同的法币进行兑换。因为这个代币只在这个账本体系下运作，其实账本也就等于这个代币。或者反过来说，代币就存储在账本中。

page14：解决了参与交易方的保障性问题，防止跑路的问题，让我们回到账本控制相关问题。首先是，如何保证某一笔交易的真实性。这个问题其实在传统交易中都给出了成熟的方案，就是通过签名和验签。开发的同事应该非常熟悉了，首先我们生成一对公私钥，签名的时候就使用私钥进行签名，然后公钥是公开的。大家想验证这笔交易的真实性，只需要使用签名那个人的公钥进行验签，就可以确认真实性。但如果，A在C的商店买过一次物品，A对自己的订单进行了签名确认。但C是由可能在后面疯狂的复制这个签过名的账单来向A进行扣款的。你没有第三方进行仲裁，这种问题又该如何避免呢？

page15：让我们退一步，有没有可能让所有人都成为仲裁者。也就是说，反其道而行之，相较于一个人拿着账本，大家往里填入交易。反过来让大家都有账本，交易一发生，一个人先记下来，并且把这笔交易广播出去，接收的人也会根据签名进行验证，验证成功既记录到自己账本。相当于一人交易，全村记账。但很不幸的是，这里又不可避免的出现一个问题，顺序问题。刚好某一时刻，多个人进行了交易，大家记账的顺序不同，这就导致了大家手上的账本可能不一致。如果交易量大地话这个不一致可能是天差地别。

page16：因为网络传输还有可能延迟，为了保证大家手上的账本都完全一致，我们就需要一个广播交易的竞争机制。只有竞争到这一时刻广播权的那个人，才可以广播交易，而且大家都有遵守。BTC和ETH是把这个机制做成了一个谜题，在某一时刻的账单下，我告诉你，添加某个特殊的数字。

page17：然后将整个账本哈希一下，得到的前n位都是0。这里先补充一些知识点。这里的哈希函数其实在签名和验签中都有涉及，我们拿SHA256这个哈希函数进行说明。首先哈希函数就是，不管你输入的是多长的内容，都输出固定长度的内容，也就是哈希值。并且即使你输入的内容只有很微量的变化，得到的哈希值也会有翻天覆地的变化。

page18：回到刚刚的谜题，我告诉你添加某个特殊数字，然后将整个账本哈希一下，得到的哈希值前n位都是0.例如前28位都是0。但是sha256是一个加密哈希，也就是说不能通过哈希值，反推出输入的内容。其实现代密码学很大程度都依赖了加密哈希的这个性质。所以，在不知道这个数字的情况下，想要得到这个数字的方法，就只能通过疯狂的随机测试，来尝试算出这个数字。这里复合谜题的数字，就是所谓的工作量证明。

page19：在工作量证明机制下，每个人在广播交易之前，都会进行这个谜题计算。直到算出来了，才会进行广播，大家才认可这些交易，才会，记入自己的账本上。这样，账本中的交易，就可以很好的得到排序，从而使得大家手上的账本都一致了。

page20：你可能也会说，大家这么辛苦来算这个谜题，为了啥？其实为了让大家都遵循这个机制，我们为每个算出谜题的人都留了预设的一笔单向交易，也就是算出来的人可以获得这笔奖励金。BTC链上，最早2009-2012年每个算出谜题的人，都能获得50BTC。然后这个以每4年奖励减半的规则延续下去，这个获得奖励的过程，也是常听到的“挖矿”。交易出现在网络上，他们就会抓取valid的交易（注意，一笔交易可以被多个人抓取），然后放入块中，再进行谜题的计算。除了奖励之外，我们交易的内容也会捆绑进去，同时也包括了这些交易的签名。最后，还会加上工作量证明，来证明这个谜题是真实被解决的。整个这个捆绑体，我们称之为块。而为了区分块的顺序，在块的头部，我们会把上一个块的整体进行一次哈希放进去。这也就可以确保了块的顺序不发生改变，不然发生改变的块的位置的后面，所有块都需要重新计算PoW。至此，终于区块链的概念出来了。由于区块链里面包含着账本，区块链，也就是账本

page21：但好景不长。。。即使我们刚刚非常严密的一个个击破了问题，但还有个情况可能发生。如果我们同时算出来了工作量证明呢?有可能我们算出来的是同一个数字，有可能是不同的数字。比如这个数字能让哈希值前30位为0，另一个数字能让前40位为0。那其实大家都符合前28位为0的要求。收到广播的人就一脸懵，两个都对呀，该听谁的。

page22：这里区块链处理的机制就是，永远以更长的链为准。如果一样长，大家先都记下来，也就是A在这一时刻，先存下B和C的两条链。这时候，就取决于第4个人了。如果工具人D和工具人B住一个小区，又恰好在接收到C的广播之前算出来了那个谜题，也就是工作量证明，这时候D就会直接广播自己的区块出去。而A，这时候就会抛弃C的链，只认可这条更长的链。细心且记忆力极好的你应该发现有个问题，C苦苦算出工作量证明之后，不但没有了算出谜题的奖励，包裹在C这个区块的交易记录也就掉链了，也就是没有放入分布式账本上，也就不能被认可了。

page23：所以区块链交易，通常都需要等待多个后续的区块续上。一个。。。两个。。。

page24：现在你也直到区块链目前最致命的缺点，也就是慢。。。

page25：接下来是一个简单的演示（要提及公钥通过转换变为了地址，交易双方是需要）

(**fast**)page26：区块链是不是仅仅只能用来记账呢？这里我们需要提及一下因为区块链而焕发新春的老概念，智能合约。想象一个场景，你在某家公司求职的时候，公司给你提出福利是，公司每挣10BTC，就会分给你2BTC。这种时候，再怎么把持不住，也要甩手给他一份合同，要他签字来确认这个条款。但于此同时，我们还需要公证人来进行公正，证明执行人双方都知情且自愿，难免有一笔公证费。公司倒是不愿意出这个钱，你也不愿意说到时候钱没给又陷入了法律纠纷。那么这时候就可以用我们的智能合约结合区块链来替换这个恼人的第三方。

page27：区块链的智能合约，我们以Ethereum为例，它其实就是使用了另一种账户。这种账户，只有地址，没有私钥（或者认为私钥就是合约里面的代码）。智能合约有两个特性。1）不可修改，一旦部署就不允许任何人修改合约内容。通常合约里面的代码是以字节码的形式存储在那个账户，一旦修改其实地址也就修改了。2）分布式，智能合约执行的输出，是所有人都可以看到且认可的。为什么会有这种性质？这和智能合约的使用方式有关。

page28：刚刚提及到智能合约是有一个地址的，执行智能合约一般都需要个输入，我们只需要使用普通ETH账户向这个地址发起交易，然后携带额外需要执行的inputs放入该请求到这个地址。智能合约账户保存了代码，获取到输入内容之后就自动执行代码内容，然后这笔特殊的“交易”出来的结果，就会存储到这笔交易里面，从而上链，也就是存储到区块链中。每个能查看区块的人，就能去查看这些内容。内容就包括了，输入是什么，输出又是什么。从而，使用技术来确保了合约的执行。

page29：去中心化交易是以网络为基础，技术担保的信任机制直接是不分国界，甚至是不分任何交易，只需要付款方愿意打钱到哪个地址，那那个地址就直接有钱了，且难以跟踪这个钱现在属于谁。以国家的层面看，BTC，ETH这些代币直接作为价值标定物，你把我法币放哪了。。。出发点的不一致，但也为了顺应更数字化的时代，各国央行纷纷研究甚至推出了CBDC，这里引出我们最后一个概念，我们着重focus on数字人民币E-CNY。

page30：首先我们常常听到的双层运营模式，央行只跟商业银行直接交互，个体与企业只跟商业银行直接交互。

page31：因为数字人民币的概念最近大家也听的得比较多，什么一币二库三中心，数字人民币，央行发行库，商业银行数字货币库。登记中心，认证中心，大数据中心。这里我们抽出交易链路中最常用的数字人民币，登记中心和认证中心。

page32：从《央行数字货币原型系统实验研究》文档中找到的，数字人民币的表达式，别看到表达式就害怕，这个很简单的。数字人民币主体至少包含id，面值，所有者，发行者以及额外内容。每一个数字人民币的币串，都是由这些要素组成，首先进行一个加密，然后再进行一个签名。

page33：这里有两份直观一点的真实币串，开发同事对这种后面有==的东西很熟悉哦，Base64编码补长用的。但E-CNY用的是国密SM2算法进行加解密的。

page34：为了更直观E-CNY交易流程，我们尝试走一趟交易链路。A转账数字RMB给B，首先是通过其商业银行的数字人民币钱包取出币串。商业银行发送转账请求到央行。央行首先将币串传输到认证中心验证其合法性，根据表达式，首先会拿到签名私钥解签，再拿加密私钥解密。确认其合法性，央行就会把币串传输到登记中心，登记中心也执行刚刚的2步操作。校验交易发起者确实所有该币串之后，就会在转账记录添加记录。然后在所属权记录中进行更替。必要的记录执行完毕之后，币串的所输人将会替换，然后重新加密，加签，得到新的币串，最后再原链路返回。显而易见，这个从账本控制的角度来看，其实是又回归到了中心化账本，也就是可靠的第三方进行担保。

page35：好的，终于，终于我们可以进行了一个总结了。今天从发展的路线差异，阐述了一下现在主流的使用第三方担保机制的传统交易，使用去中心化的区块链交易，以及各国政府为数字化转型推行的央行数字货币交易的异同点。最根本的区别其实是账本控制权放在了哪里，传统交易就是让可靠的第三方处理，手续费高，区块链交易就是大家商量好一个机制，处理速度可能慢一点点，CBDC交易让国家处理和担保，监管性就很强。我们不妨用4个维度来进一步区分，分别是使用成本，健壮性，接入难度，实时性4个维度。传统支付目前以及很成熟，几乎没有建设成本，接入难度也很低，只有使用成本。可靠性就依赖第三方了，实时性大家现在买单也很迅速嘛。区块链支付就比较不一样，由于每个人都有账本，而且接入区块链主要也就是有网就ok了，这两个直接拉满。然后使用成本，因为少了很多第三方，基本没有什么交易附加费。但目前实时性上还需要等ETH2.0这样新协议出来才能很好的改进。最后是我们的CBDC，虽然是依附在现有传统支付之上，但是还需要额外的开发成本，可靠性取决于国家的综合国力了，这个比单一第三方会好一点。接入性上，国家会大力的推行使用，所以会比传统支付要更便捷一些。

page36：这次的分享终于结束了，非常感谢大家的到来。